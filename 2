sudo apt update
sudo apt install samba samba-common smbclient winbind libnss-winbind libpam-winbind krb5-user

MI-DOMINIO.LOCAL

127.0.0.1
127.0.0.1

sudo systemctl stop smbd nmbd winbind
sudo systemctl disable smbd nmbd winbind

sudo mv /etc/samba/smb.conf /etc/samba/smb.conf.back

sudo samba-tool domain provision --use-rfc2307 --interactive

Te pedirá:

Realm: en mayúsculas (ej: MI-DOMINIO.LOCAL)

Domain: en minúsculas (ej: mi-dominio)

Server Role: dc

DNS backend: SAMBA_INTERNAL

Administrator password: tu contraseña

3️⃣ Usar la nueva configuración

Edita /etc/krb5.conf y reemplázalo con lo que generó Samba:

sudo cp /var/lib/samba/private/krb5.conf /etc/krb5.conf

Inicia Samba como servicio:

sudo systemctl unmask samba-ad-dc
sudo systemctl enable samba-ad-dc
sudo systemctl start samba-ad-dc

4️⃣ Crear el usuario teteretere

sudo samba-tool user create teteretere

5️⃣ Comprobar que Samba funciona
host -t SRV _ldap._tcp.mi-dominio.local
host -t SRV _kerberos._tcp.mi-dominio.local

6️⃣ Configurar la VM de Windows para unirla al dominio

En Windows (dentro de tu máquina virtual):

Abre Panel de Control → Sistema → Configuración avanzada del sistema → Nombre del equipo.

Haz clic en Cambiar.

Marca Dominio y escribe:
mi-dominio.local

Te pedirá usuario y contraseña de administrador del dominio:

Usuario: Administrator

Contraseña: la que pusiste en la configuración de Samba.

Si todo sale bien, te dirá Bienvenido al dominio.

Reinicia Windows.
